<div>
  <div class="mrc-page-title">{{ pageTitle }}</div>
  <div class="mrc-page-subtitle">{{ pageSubtitle }}</div>
</div>
<progress-spinner [progress]="loading">
  <div *ngIf="foodPlan" class="page-food-plan-edit-column">
    <div class="page-food-plan-edit-content"> 
      <mat-form-field floatLabel="always" class="page-food-plan-edit-content-description-field">
        <mat-label>Descrição</mat-label>
        <textarea matInput [formControl]="descriptionFormControl" [(ngModel)]="foodPlan.description"></textarea>
        <mat-error>Campo <strong>obrigatório</strong></mat-error>
      </mat-form-field>

      <div class="page-food-plan-edit-content-food-source-type">
        <label>{{ foodTypeSelectTxt }}</label>
        <mat-radio-group (change)="on_food_source_change($event)">
          <mat-radio-button [value]="true" [checked]="foodPlan.useFoodDb" #radioBtnCalc>Cardápio calculado</mat-radio-button>
          <mat-radio-button [value]="false" [checked]="!foodPlan.useFoodDb" #radioBtnFree>Cardápio livre</mat-radio-button>
          <!-- TODO: Helper -->
        </mat-radio-group>
      </div>
      <div class="page-food-plan-edit-content-meals">
        <label>Refeições</label>
        <button mat-button (click)="on_add_meal_click()" style="max-width: 80px">Adicionar</button>
        <ng-container *ngFor="let meal of foodPlan.meals; let i = index">
          <mat-card>
            <h1>{{ meal.mealName }}</h1>
            <div class="page-food-plan-edit-content-meals-container">
              <div class="page-food-plan-edit-content-meals-container-time">{{ meal.mealTime }}</div>
              <ul class="page-food-plan-edit-content-meals-container-food-list" *ngIf="foodPlan.useFoodDb; else elseBlock">
                <li *ngFor="let food of meal.selectedFoods">
                  {{ formatFoodDetail(food) }}
                </li>
              </ul>
              <ng-template #elseBlock>
                <ul class="page-food-plan-edit-content-meals-container-food-list">
                  <li *ngFor="let food of freeTextFoodsList(meal)">
                    {{ food }}
                  </li>
                </ul>
              </ng-template>
            </div>
            <div class="page-food-plan-edit-content-meals-footer">
              <span title="Editar" class="icon-edit" (click)="on_add_meal_click(meal, i)"></span> 
              <span title="Remover" class="icon-delete" (click)="on_remove_meal_click(meal, i)"></span>
              <button mat-button *ngIf="!foodPlan.isRecall">Adicionar substituição</button> <!-- TODO:  (click)=""-->
            </div>
          </mat-card>
        </ng-container>
      </div>
    </div>
    <div class="page-food-plan-edit-macros" *ngIf="foodPlan.useFoodDb">
      <label>Macronutrientes</label>
      <div class="page-food-plan-edit-macros-content">
        <mrc-pie-chart [data]="pieChartData" [unit]="pieChartUnit" [hideLegend]="true"></mrc-pie-chart>
        <table>
          <tr>
            <td></td>
            <td class="mrc-col-desc">Proteínas</td>
            <td class="mrc-col-value">{{ ptnSum | unitFormater: 'g':'2' }}</td>
            <td>{{ getMacroPercent(ptnSum) | unitFormater: '%':'2' }}</td>
          </tr>
          <tr>
            <td></td>
            <td class="mrc-col-desc">Carboidratos</td>
            <td class="mrc-col-value">{{ choSum | unitFormater: 'g':'2' }}</td>
            <td>{{ getMacroPercent(choSum) | unitFormater: '%':'2' }}</td>
          </tr>
          <tr>
            <td></td>
            <td class="mrc-col-desc">Lipídios</td>
            <td class="mrc-col-value">{{ lipSum | unitFormater: 'g':'2' }}</td>
            <td>{{ getMacroPercent(lipSum) | unitFormater: '%':'2' }}</td>
          </tr>
          <tr>
            <td></td>
            <td class="mrc-col-desc">Energia</td>
            <td class="mrc-col-value">{{ energySum | unitFormater: 'kcal':'2' }}</td>
            <td></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</progress-spinner>
<div id="mrc-edit-page-footer">
  <div class="mrc-dialog-separator"></div>
  <!-- <div *ngFor="let msg of errorList" class="mrc-edit-page-error">{{ msg }}</div>  -->
  <div id="mrc-edit-page-footer-buttons">
    <button mat-button [disabled]="!dirty && !isNew" (click)="on_save_clicked()">Salvar</button> 
    <button mat-button (click)="on_cancel_clicked()">Cancelar</button>
  </div>
</div>
<div class="mrc-dialog-title">Adicionar refeição</div>
<!-- <ng-template #editModeTitle>
  <div class="mrc-dialog-title">Editar usuário</div>
</ng-template> -->
<div class="mrc-dialog-separator"></div>
<div>
  <div style="display: flex">
    <div style="width: 120px">
      <mat-form-field floatLabel="always" style="margin-left: 8px">
        <mat-label>Refeição</mat-label>
        <mat-select [(ngModel)]="selecteMealId" [formControl]="mealSelectCtrl">
          <mat-option *ngFor="let meal of mealGroups" [value]="meal.id">{{ meal.description }}</mat-option>
          <mat-option value="0">Outra</mat-option>
        </mat-select>
      </mat-form-field>
      <ng-container *ngIf="selecteMealId == '0'">
        <input placeholder="Nome da refeição">         
      </ng-container>
    </div>
    <div>
      <label>Horário da refeição</label>
      <input aria-label="24hr format" [ngxTimepicker]="fullTime" [value]="mealTime" [format]="24" readonly> 
      <ngx-material-timepicker #fullTime></ngx-material-timepicker>
    </div>
  </div>
  <div *ngIf="useFoodDb" style="display: flex; flex-direction: column;">
    <label>Banco de dados de alimentos</label>
    <mat-radio-group [(ngModel)]="selectedFoodSource">
      <mat-radio-button [value]="foodSourceEnum.All">Todos</mat-radio-button>
      <mat-radio-button [value]="foodSourceEnum.Taco">TACO</mat-radio-button>
      <mat-radio-button [value]="foodSourceEnum.MyFoods">Meus alimentos</mat-radio-button>
      <mat-radio-button [value]="foodSourceEnum.MySupplements">Meus suplementos</mat-radio-button>
    </mat-radio-group>
  </div>
  <mat-form-field floatLabel="always" style="margin-left: 8px"> 
    <mat-label>Pesquisar alimento</mat-label>
    <mat-select [formControl]="foodCtrl" placeholder="Digite no mínimo 3 caracteres" (selectionChange)="on_selection_change($event)" #select>
      <mat-option>
        <ngx-mat-select-search [formControl]="foodFilterCtrl" placeholderLabel="Digite no mínimo 3 caracteres">
          <mat-icon ngxMatSelectSearchClear>X</mat-icon>
        </ngx-mat-select-search>
      </mat-option>

      <mat-option *ngFor="let food of filteredFoods | async" [value]="food">
        {{food.description}}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <div>
    <mat-table [dataSource]="dataSource">
      <ng-container matColumnDef="description">
        <mat-header-cell *matHeaderCellDef>Descrição</mat-header-cell>
        <mat-cell *matCellDef="let element">{{ element.description }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="quantity">
        <mat-header-cell *matHeaderCellDef>Quantidade</mat-header-cell>
        <mat-cell *matCellDef="let element; let i = index;">
          <mat-form-field>
            <input matInput type="number" [formControl]="quantityFormControls[i]" [(ngModel)]="element.quantity" (ngModelChange)="on_quantity_change()">
          </mat-form-field>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="measurements">
        <mat-header-cell *matHeaderCellDef>Medida</mat-header-cell>
        <mat-cell *matCellDef="let element">
          <mat-select [(ngModel)]="element.selectedMeasurement">
            <mat-option *ngFor="let option of element.measurements" [value]="option.id">{{ option.description }}</mat-option>
          </mat-select>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="commands">
        <mat-header-cell *matHeaderCellDef></mat-header-cell>
        <mat-cell *matCellDef="let element; let i = index;"> 
          <span>
            <span title="Remover" class="icon-delete" (click)="on_remove_food_click($event, element, i)"></span> 
          </span>  
        </mat-cell>
      </ng-container>
  
      <mat-header-row *matHeaderRowDef="tableDisplayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: tableDisplayedColumns;"></mat-row>
    </mat-table>

    <ngx-charts-pie-chart 
      [view]="view"
      [scheme]="colorScheme"
      [results]="chartData"
      [gradient]="gradient"
      [legend]="showLegend">

    </ngx-charts-pie-chart>
  </div>
</div>
<div id="mrc-edit-page-footer">
  <div class="mrc-dialog-separator"></div>
  <!-- <div *ngFor="let msg of errorList" class="mrc-edit-page-error">{{ msg }}</div>  -->
  <div id="mrc-edit-page-footer-buttons">
    <button mat-button>Salvar</button> <!-- TODO: [disabled]="!dirty && !isNew" (click)="on_save_clicked()" -->
    <button mat-button (click)="on_cancel_click()">Cancelar</button>
  </div>
</div>